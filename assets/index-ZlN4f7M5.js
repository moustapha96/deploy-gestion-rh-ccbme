import{u as C,E as N,k,m as h,n as S,o as E,U as n,j as e,P as z,W as q,X as A,F as P}from"./index-Cv26Y6gL.js";import{r as c,u as V,i as _}from"./vendor-iLaNCrNf.js";const F=()=>{const{isAuthenticated:r,userInfo:o,saveSession:i}=C(),[f,d]=c.useState(!1),a=V(),[g]=_(),{urlApi:b}=c.useContext(N);console.log(r,o),c.useEffect(()=>{r&&o.role=="secondary_user"&&o.email=="alhussein.khouma@ccbm.sn"?a("/gestion/dashboard"):r&&o.role=="main_user"?a("/admin/dashboard"):a("/auth/sign-in")},[r,o]);const x=k({email:h().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),password:h().required("Veuillez entrer votre mot de passe")}),{control:w,handleSubmit:j}=S({resolver:E(x),defaultValues:{email:"",password:""}}),v=g.get("redirectTo")??"/admin/dashboard",y=j(async u=>{d(!0),console.log(u);try{const s=await fetch(b+"auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u.email,password:u.password})}),t=await s.json();if(console.log(s),console.log(t),console.log("response"),t.error){n.error(t.error,{position:"top-right",duration:3e3});return}const L=t.user_info.role,{user_info:l,access_token:m,parent:p}=t;if(console.log("response de la requette ",l,m,p),!m)throw new Error("Token d'accès non trouvé dans la réponse");l.role==="main_user"&&p?(i(t),n.success("Connexion réussie. Redirection...",{position:"top-right",duration:2e3}),a(v)):l.role==="secondary_user"&&l.email==="alhussein.khouma@ccbm.sn"?(i(t),n.success("Connexion réussie. Redirection...",{position:"top-right",duration:2e3}),a("/gestion/dashboard")):(n.error("Vous devez vous connecter en tant qu'utilisateur principal.",{position:"top-right",duration:3e3}),a("/auth/login"))}catch(s){s.response?(console.error("Error response:",s.response.data),console.error("Error status:",s.response.status),console.error("Error headers:",s.response.headers),s.response.status===404?n.error("L'URL de l'API est introuvable. Veuillez vérifier la configuration.",{position:"top-right",duration:3e3}):n.error(s.response.data.message||"Une erreur s'est produite lors de la connexion.",{position:"top-right",duration:2e3})):s.request&&(console.error("Error request:",s.request),n.error("Aucune réponse reçue du serveur. Veuillez vérifier votre connexion.",{position:"top-right",duration:3e3}))}finally{d(!1)}});return{loading:f,login:y,control:w}},U=()=>{const{loading:r,login:o,control:i}=F();return e.jsxs(e.Fragment,{children:[e.jsx(z,{title:"Connexion"}),e.jsxs("form",{className:"mt-2 shrink",onSubmit:o,children:[e.jsx(q,{containerClassName:"mb-4",label:"Adresse email",name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:i}),e.jsx(A,{label:"Mot de passe",containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:i}),e.jsx("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2",children:e.jsx("div",{})}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{type:"submit",disabled:r,className:"group mt-5 inline-flex w-full items-center justify-center rounded bg-blueLogo px-6 py-2.5 text-white backdrop-blur-2xl transition-all hover:text-white",children:[r?"Chargement...":"Se connecter",r&&e.jsx(P,{className:"ml-2 animate-spin"})]})})]}),e.jsx("br",{})]})};export{U as default};
