import{Y as C,O as z,m as k,n as x,U as o,j as e,P as L,Q as b}from"./index-DxOCyLaC.js";import{r as i,h as S,L as E}from"./vendor-DvxF9bYu.js";import{o as R}from"./yup-CBYd5xIv.js";import{u as P}from"./resolvers-feI25x5d.js";import{T as y}from"./TextFormInput-BiboZlSY.js";async function T(n){try{return(await C.get(`/api/partner/${n}/otp-resend`)).data}catch(a){throw console.error("Erreur lors de la création du modèle",a),a}}const I=()=>{const{urlApi:n}=i.useContext(z),a=S(),[l,d]=i.useState(!1),[c,m]=i.useState(!1),[s,u]=i.useState(0),g=k({email:x().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),code:x().required("Veuillez entrer le code").matches(/^\d{4}$/,"Le code doit contenir 4 chiffres")}),{control:f,handleSubmit:v,watch:$,reset:w,setValue:j,getValues:p}=P({resolver:R(g),defaultValues:{email:"",code:""}});i.useEffect(()=>{const r=new URLSearchParams(location.search).get("email");if(console.log(r),!r){o.error("Information utilisateur manquante. Veuillez vous inscrire à nouveau."),a("/auth/sign-up");return}j("email",r)},[location,a]),i.useEffect(()=>{if(s>0){const t=setTimeout(()=>u(s-1),1e3);return()=>clearTimeout(t)}},[s]);const N=async t=>{d(!0);try{const r=await fetch(`${n}partner/otp-verification`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log(r),!r.ok){const h=await r.json();console.error("Erreur de l'API :",h),o.error(h||"Erreur lors de la création du compte");return}o.success("Votre compte a été vérifié avec succès!"),w(),a("/auth/sign-in?mail="+t.email)}catch(r){console.error(r),o.error(res.message||"Le code de vérification est incorrect.")}finally{d(!1)}},V=async()=>{if(!(!email||s>0)){m(!0);try{const t=await T(email);console.log(t),o.success("Un nouveau code a été envoyé à votre adresse email."),u(60)}catch(t){console.error(t),o.error("Une erreur est survenue. Veuillez réessayer.")}finally{m(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"Vérification de compte"}),e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Vérification de compte"}),e.jsx("p",{className:"mt-2 text-zinc-300",children:"Veuillez entrer le code à 4 chiffres que nous avons envoyé à votre adresse email."})]}),e.jsxs("form",{onSubmit:v(N),className:"mt-6 shrink",children:[e.jsx(y,{containerClassName:"mb-4",label:"Adresse email",name:"email",disabled:p("email"),labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",placeholder:"Entrez votre email",fullWidth:!0,control:f}),e.jsx(y,{containerClassName:"mb-4",label:"Code de vérification",name:"code",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0 text-center text-2xl tracking-widest",placeholder:"0000",maxLength:4,fullWidth:!0,control:f}),e.jsxs("div",{className:"mb-6 flex flex-col justify-center gap-4",children:[e.jsxs("button",{type:"submit",disabled:l,className:"relative inline-flex w-full items-center justify-center rounded bg-primary px-6 py-3 text-base capitalize text-white transition-all hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[l?"Vérification...":"Vérifier le compte",l&&e.jsx(b,{className:"ml-2 animate-spin"})]}),e.jsxs("button",{type:"button",onClick:V,disabled:c||s>0||!p("email"),className:"relative inline-flex w-full items-center justify-center rounded border border-white/20 bg-transparent px-6 py-3 text-base capitalize text-white/80 transition-all hover:bg-white/5 disabled:opacity-50 disabled:cursor-not-allowed",children:[c?"Envoi en cours...":s>0?`Renvoyer le code (${s}s)`:"Renvoyer le code",c&&e.jsx(b,{className:"ml-2 animate-spin"})]})]})]}),e.jsxs("p",{className:"shrink text-center text-zinc-200",children:["Retour à la",e.jsx(E,{to:"/auth/sign-in",className:"ms-1 text-primary",children:e.jsx("b",{children:"Connexion"})})]})]})};export{I as default};
