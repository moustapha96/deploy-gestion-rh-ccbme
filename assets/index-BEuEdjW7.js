import{u as v,O as A,U as t,m as E,n as f,j as e,P,Q as T}from"./index-4b2E4gzR.js";import{P as _}from"./PasswordFormInput-B_e0-UNx.js";import{T as q}from"./TextFormInput-BIBTBes0.js";import{r as c,h as F,i as I}from"./vendor-DvxF9bYu.js";import{o as L}from"./yup-CBYd5xIv.js";import{u as M}from"./resolvers-feI25x5d.js";const U=()=>{const{isAuthenticated:s,userInfo:r,saveSession:o}=v(),[h,u]=c.useState(!1),a=F(),[b]=I(),{urlApi:x}=c.useContext(A),p=b.get("redirectTo")??"/admin/dashboard";c.useEffect(()=>{s&&(r.role==="main_user"?a("/admin/dashboard"):r.role==="secondary_user"&&r.email==="alhussein.khouma@ccbm.sn"?a("/gestion/dashboard"):(t.error("Accès refusé."),a("/auth/login")))},[s,r]);const g=E({email:f().email("Email invalide").required("Email requis"),password:f().required("Mot de passe requis")}),{control:w,handleSubmit:j}=M({resolver:L(g),defaultValues:{email:"",password:""}}),y=j(async({email:N,password:C})=>{u(!0);try{const n=await(await fetch(`${x}auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:N,password:C})})).json();if(n.error){t.error(n.error);return}const{user_info:i,access_token:S,parent:l}=n;if(!S)throw new Error("Token d'accès manquant.");if(!l||!l.id){t.error("Aucune entreprise associée.");return}const d=i.role==="main_user"&&l,k=i.role==="secondary_user"&&i.email==="alhussein.khouma@ccbm.sn";d||k?(o(n),t.success("Connexion réussie."),a(d?p:"/gestion/dashboard")):(t.error("Rôle non autorisé."),a("/auth/login"))}catch(m){console.error(m),t.error("Erreur de connexion. Vérifiez votre connexion ou les identifiants.")}finally{u(!1)}});return{loading:h,login:y,control:w}},D=()=>{const{loading:s,login:r,control:o}=U();return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Connexion"}),e.jsxs("form",{className:"mt-2 shrink",onSubmit:r,children:[e.jsx(q,{containerClassName:"mb-4",label:"Adresse email",name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:o}),e.jsx(_,{label:"Mot de passe",containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:o}),e.jsx("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2",children:e.jsx("div",{})}),e.jsx("div",{className:"text-center text-sm justify-between ",children:e.jsxs("button",{type:"submit",disabled:s,className:"group mt-5 inline-flex w-2/3 items-center justify-center rounded bg-blueLogo px-6 py-2.5 text-white backdrop-blur-2xl transition-all hover:text-white",children:[s?"Chargement...":"Se connecter",s&&e.jsx(T,{className:"ml-2 animate-spin"})]})})]}),e.jsx("br",{})]})};export{D as default};
