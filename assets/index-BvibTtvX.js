import{u as w,C as j,h as v,i as u,k as y,o as C,U as s,j as r,P as N,S,V as k,D as z}from"./index-DHlyfRUS.js";import{r as c,u as V,i as E}from"./vendor-iLaNCrNf.js";const P=()=>{const[t,a]=c.useState(!1),n=V(),[d]=E(),{saveSession:p}=w(),{urlApi:m}=c.useContext(j),g=v({email:u().email("Veuillez entrer un email valide").required("Veuillez entrer votre email"),password:u().required("Veuillez entrer votre mot de passe")}),{control:h,handleSubmit:x}=y({resolver:C(g),defaultValues:{email:"",password:""}}),f=d.get("redirectTo")??"/admin/dashboard",b=x(async i=>{a(!0),console.log(i);try{const e=await fetch(m+"auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:i.email,password:i.password})}),o=await e.json();if(console.log(e),console.log(o),console.log("response"),o.error){s.error(o.error,{position:"top-right",duration:3e3});return}const l=o.user_info.role;if(o.access_token&&l=="main_user"&&o.parent)p(o),s.success("Connexion réussie. Redirection...",{position:"top-right",duration:2e3}),n(f),console.log("role",l);else throw s.error("Vous devez vous connecter en tant que utilisateur principal.",{position:"top-right",duration:3e3}),n("/auth/login"),new Error("Token d'accès non trouvé dans la réponse")}catch(e){e.response?(console.error("Error response:",e.response.data),console.error("Error status:",e.response.status),console.error("Error headers:",e.response.headers),e.response.status===404?s.error("L'URL de l'API est introuvable. Veuillez vérifier la configuration.",{position:"top-right",duration:3e3}):s.error(e.response.data.message||"Une erreur s'est produite lors de la connexion.",{position:"top-right",duration:2e3})):e.request&&(console.error("Error request:",e.request),s.error("Aucune réponse reçue du serveur. Veuillez vérifier votre connexion.",{position:"top-right",duration:3e3}))}finally{a(!1)}});return{loading:t,login:b,control:h}},L=()=>{const{loading:t,login:a,control:n}=P();return r.jsxs(r.Fragment,{children:[r.jsx(N,{title:"Connexion"}),r.jsxs("form",{className:"mt-2 shrink",onSubmit:a,children:[r.jsx(S,{containerClassName:"mb-4",label:"Adresse email",name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:n}),r.jsx(k,{label:"Mot de passe",containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:n}),r.jsx("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2"}),r.jsx("div",{className:"text-center",children:r.jsxs("button",{type:"submit",disabled:t,className:"group mt-5 inline-flex w-full items-center justify-center rounded bg-blueLogo px-6 py-2.5 text-white backdrop-blur-2xl transition-all hover:text-white",children:[t?"Chargement...":"Se connecter",t&&r.jsx(z,{className:"ml-2 animate-spin"})]})})]}),r.jsx("br",{})]})};export{L as default};
