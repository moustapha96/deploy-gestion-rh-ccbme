import{u as S,N as A,U as t,k as E,m as f,j as e,P,O as L}from"./index-CT4m-n51.js";import{P as T}from"./PasswordFormInput-BObYJSp9.js";import{T as _}from"./TextFormInput-BfLItilx.js";import{r as c,h as q,i as F,L as z}from"./vendor-DvxF9bYu.js";import{o as I}from"./yup-CBYd5xIv.js";import{u as M}from"./resolvers-feI25x5d.js";const U=()=>{const{isAuthenticated:s,userInfo:r,saveSession:o}=S(),[h,m]=c.useState(!1),a=q(),[x]=F(),{urlApi:p}=c.useContext(A),b=x.get("redirectTo")??"/admin/dashboard";c.useEffect(()=>{s&&(r.role==="main_user"?a("/admin/dashboard"):r.role==="secondary_user"&&r.email==="alhussein.khouma@ccbm.sn"?a("/gestion/dashboard"):(t.error("Accès refusé."),a("/auth/login")))},[s,r]);const g=E({email:f().email("Email invalide").required("Email requis"),password:f().required("Mot de passe requis")}),{control:w,handleSubmit:j}=M({resolver:I(g),defaultValues:{email:"",password:""}}),y=j(async({email:N,password:k})=>{m(!0);try{const n=await(await fetch(`${p}auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:N,password:k})})).json();if(n.error){t.error(n.error);return}const{user_info:i,access_token:v,parent:l}=n;if(!v)throw new Error("Token d'accès manquant.");if(!l||!l.id){t.error("Aucune entreprise associée.");return}const d=i.role==="main_user"&&l,C=i.role==="secondary_user"&&i.email==="alhussein.khouma@ccbm.sn";d||C?(o(n),t.success("Connexion réussie."),a(d?b:"/gestion/dashboard")):(t.error("Rôle non autorisé."),a("/auth/login"))}catch(u){console.error(u),t.error("Erreur de connexion. Vérifiez votre connexion ou les identifiants.")}finally{m(!1)}});return{loading:h,login:y,control:w}},J=()=>{const{loading:s,login:r,control:o}=U();return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"Connexion"}),e.jsxs("form",{className:"mt-2 shrink",onSubmit:r,children:[e.jsx(_,{containerClassName:"mb-4",label:"Adresse email",name:"email",labelClassName:"block text-base/normal text-zinc-200 font-semibold",className:"block rounded border-white/10 bg-transparent py-2.5 text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",fullWidth:!0,control:o}),e.jsx(T,{label:"Mot de passe",containerClassName:"mb-4",name:"password",labelClassName:"block text-base/normal text-zinc-200 font-semibold",fullWidth:!0,className:"block w-full rounded border-white/10 py-2.5 bg-transparent text-white/80 focus:border-white/25 focus:outline-0 focus:ring-0",control:o}),e.jsx("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-x-1 gap-y-2",children:e.jsx("div",{})}),e.jsxs("div",{className:"text-center text-sm justify-between ",children:[e.jsxs("button",{type:"submit",disabled:s,className:"group mt-5 inline-flex w-2/3 items-center justify-center rounded bg-blueLogo px-6 py-2.5 text-white backdrop-blur-2xl transition-all hover:text-white",children:[s?"Chargement...":"Se connecter",s&&e.jsx(L,{className:"ml-2 animate-spin"})]}),e.jsxs("p",{className:"mt-4 text-center text-sm text-white ",children:["Vous n'avez pas de compte ?"," ",e.jsx(z,{to:"/auth/sign-up",className:"font-medium text-primary hover:text-primary-dark",children:"S'inscrire"})]})]})]}),e.jsx("br",{})]})};export{J as default};
